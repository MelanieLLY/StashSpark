# ğŸ“‚ StashSpark é¡¹ç›®ç»“æ„è¯¦è§£

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚         â”‚    Backend      â”‚         â”‚   Database      â”‚
â”‚   (React)       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   (Express)     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  (PostgreSQL)   â”‚
â”‚   Port: 5173    â”‚  HTTP   â”‚   Port: 3001    â”‚   SQL   â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ è¯¦ç»†æ–‡ä»¶ç»“æ„

### ğŸ¨ å®¢æˆ·ç«¯ (Client)

```
client/
â”‚
â”œâ”€â”€ ğŸ“„ index.html                    # HTML å…¥å£
â”œâ”€â”€ ğŸ“„ package.json                  # ä¾èµ–é…ç½®
â”œâ”€â”€ ğŸ“„ vite.config.js               # Vite é…ç½®
â”œâ”€â”€ ğŸ“„ tailwind.config.js           # Tailwind é…ç½®
â”œâ”€â”€ ğŸ“„ postcss.config.js            # PostCSS é…ç½®
â”‚
â””â”€â”€ ğŸ“ src/
    â”‚
    â”œâ”€â”€ ğŸ“„ main.jsx                 # React å…¥å£æ–‡ä»¶
    â”œâ”€â”€ ğŸ“„ App.jsx                  # ä¸»åº”ç”¨ç»„ä»¶ï¼ˆè·¯ç”±é…ç½®ï¼‰
    â”œâ”€â”€ ğŸ“„ index.css                # å…¨å±€æ ·å¼ + Tailwind
    â”‚
    â”œâ”€â”€ ğŸ“ api/                     # API è°ƒç”¨å±‚
    â”‚   â”œâ”€â”€ auth.js                 # è®¤è¯ç›¸å…³ API
    â”‚   â””â”€â”€ bookmarks.js            # ä¹¦ç­¾ç›¸å…³ API
    â”‚
    â”œâ”€â”€ ğŸ“ hooks/                   # è‡ªå®šä¹‰ Hooks
    â”‚   â””â”€â”€ useAuth.js              # è®¤è¯çŠ¶æ€ç®¡ç†
    â”‚
    â”œâ”€â”€ ğŸ“ pages/                   # é¡µé¢ç»„ä»¶
    â”‚   â”œâ”€â”€ LoginPage.jsx           # ç™»å½•é¡µ
    â”‚   â”œâ”€â”€ SignupPage.jsx          # æ³¨å†Œé¡µ
    â”‚   â”œâ”€â”€ AllBookmarksPage.jsx    # æ‰€æœ‰ä¹¦ç­¾é¡µ
    â”‚   â””â”€â”€ ReviewTodayPage.jsx     # ä»Šæ—¥å¤ä¹ é¡µ
    â”‚
    â””â”€â”€ ğŸ“ components/              # å¯å¤ç”¨ç»„ä»¶
        â”‚
        â”œâ”€â”€ ğŸ“ Layout/              # å¸ƒå±€ç»„ä»¶
        â”‚   â”œâ”€â”€ AppLayout.jsx       # ä¸»å¸ƒå±€ï¼ˆå«è®¤è¯æ£€æŸ¥ï¼‰
        â”‚   â””â”€â”€ Sidebar.jsx         # ä¾§è¾¹æ å¯¼èˆª
        â”‚
        â””â”€â”€ ğŸ“ bookmarks/           # ä¹¦ç­¾ç›¸å…³ç»„ä»¶
            â”œâ”€â”€ AddBookmarkForm.jsx  # æ·»åŠ ä¹¦ç­¾è¡¨å•
            â”œâ”€â”€ BookmarkList.jsx     # ä¹¦ç­¾åˆ—è¡¨å®¹å™¨
            â”œâ”€â”€ BookmarkItem.jsx     # å•ä¸ªä¹¦ç­¾å¡ç‰‡
            â”œâ”€â”€ BookmarkEditor.jsx   # ç¬”è®°ç¼–è¾‘å™¨
            â””â”€â”€ SummaryBox.jsx       # AI æ‘˜è¦å±•ç¤º
```

### ğŸ–¥ï¸ æœåŠ¡ç«¯ (Server)

```
server/
â”‚
â”œâ”€â”€ ğŸ“„ server.js                    # Express å…¥å£æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ package.json                 # ä¾èµ–é…ç½®
â”œâ”€â”€ ğŸ“„ .env.example                 # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”‚
â”œâ”€â”€ ğŸ“ config/                      # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ dotenv.js                   # ç¯å¢ƒå˜é‡åŠ è½½
â”‚   â”œâ”€â”€ database.js                 # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ database.sql                # æ•°æ®åº“è¡¨ç»“æ„ SQL
â”‚   â”œâ”€â”€ reset.js                    # æ•°æ®åº“é‡ç½®è„šæœ¬
â”‚   â””â”€â”€ session.js                  # Session ç®¡ç†
â”‚
â”œâ”€â”€ ğŸ“ middleware/                  # Express ä¸­é—´ä»¶
â”‚   â””â”€â”€ auth.js                     # è®¤è¯ä¸­é—´ä»¶
â”‚
â”œâ”€â”€ ğŸ“ routes/                      # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ authRoutes.js               # è®¤è¯è·¯ç”±
â”‚   â””â”€â”€ bookmarkRoutes.js           # ä¹¦ç­¾è·¯ç”±
â”‚
â””â”€â”€ ğŸ“ controllers/                 # ä¸šåŠ¡é€»è¾‘æ§åˆ¶å™¨
    â”œâ”€â”€ authController.js           # è®¤è¯é€»è¾‘
    â””â”€â”€ bookmarkController.js       # ä¹¦ç­¾é€»è¾‘
```

---

## ğŸ”„ æ•°æ®æµå‘

### ç”¨æˆ·ç™»å½•æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    1. è¾“å…¥é‚®ç®±å¯†ç     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç•Œé¢ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ LoginPage    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ 2. è°ƒç”¨ login()
                                        â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ api/auth.js  â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ 3. POST /api/auth/login
                                        â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ authRoutes   â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ 4. è°ƒç”¨æ§åˆ¶å™¨
                                        â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚authControllerâ”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ 5. æŸ¥è¯¢æ•°æ®åº“
                                        â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚  PostgreSQL  â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ 6. è¿”å›ç”¨æˆ·æ•°æ®
                                        â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ åˆ›å»º Session â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ 7. è®¾ç½® Cookie
                                        â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚   å‰ç«¯å­˜å‚¨    â”‚
                                  â”‚   ç”¨æˆ·ä¿¡æ¯    â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ 8. è·³è½¬åˆ° /app
                                        â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚  Dashboard   â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ·»åŠ ä¹¦ç­¾æµç¨‹

```
ç”¨æˆ·ç²˜è´´ URL
    â†“
AddBookmarkForm.jsx
    â†“
api/bookmarks.createBookmark()
    â†“
POST /api/bookmarks
    â†“
requireAuth ä¸­é—´ä»¶ï¼ˆæ£€æŸ¥ç™»å½•ï¼‰
    â†“
bookmarkController.createBookmark()
    â†“
1. æå–åŸŸåï¼ˆnew URL().hostnameï¼‰
2. æ’å…¥æ•°æ®åº“
    â†“
è¿”å›æ–°ä¹¦ç­¾æ•°æ®
    â†“
å‰ç«¯æ›´æ–°åˆ—è¡¨ï¼ˆonBookmarkAddedï¼‰
    â†“
æ˜¾ç¤ºåœ¨ BookmarkList ä¸­
```

### å¤ä¹ ç³»ç»Ÿæµç¨‹

```
ç”¨æˆ·è®¾ç½®å¤ä¹ é—´éš”ï¼ˆå¦‚ 3 å¤©ï¼‰
    â†“
BookmarkEditor è®¡ç®— next_review_at
    â†“
PUT /api/bookmarks/:id
    â†“
æ›´æ–°æ•°æ®åº“
    â†“
3 å¤©å...
    â†“
ç”¨æˆ·è®¿é—® ReviewTodayPage
    â†“
GET /api/bookmarks/review/today
    â†“
SQL: WHERE next_review_at <= NOW()
    â†“
è¿”å›å¾…å¤ä¹ ä¹¦ç­¾åˆ—è¡¨
    â†“
ç”¨æˆ·ç‚¹å‡»"æ ‡è®°ä¸ºå·²å¤ä¹ "
    â†“
POST /api/bookmarks/:id/mark-reviewed
    â†“
æ›´æ–° last_reviewed_at å’Œ next_review_at
    â†“
ä»åˆ—è¡¨ä¸­ç§»é™¤
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½å®ç°ä½ç½®

### 1. ç”¨æˆ·è®¤è¯

| åŠŸèƒ½ | å‰ç«¯ | åç«¯ | æ•°æ®åº“ |
|-----|------|------|--------|
| æ³¨å†Œ | `SignupPage.jsx` | `authController.register` | `users` è¡¨ |
| ç™»å½• | `LoginPage.jsx` | `authController.login` | `users` è¡¨ |
| ç™»å‡º | `Sidebar.jsx` | `authController.logout` | æ¸…é™¤ session |
| çŠ¶æ€ç®¡ç† | `useAuth.js` | `authController.getCurrentUser` | - |

### 2. ä¹¦ç­¾ç®¡ç†

| åŠŸèƒ½ | å‰ç«¯ | åç«¯ | æ•°æ®åº“ |
|-----|------|------|--------|
| æŸ¥çœ‹æ‰€æœ‰ | `AllBookmarksPage.jsx` | `bookmarkController.getAllBookmarks` | `bookmarks` è¡¨ |
| æ·»åŠ  | `AddBookmarkForm.jsx` | `bookmarkController.createBookmark` | INSERT |
| ç¼–è¾‘ | `BookmarkEditor.jsx` | `bookmarkController.updateBookmark` | UPDATE |
| åˆ é™¤ | `BookmarkItem.jsx` | `bookmarkController.deleteBookmark` | DELETE |
| æœç´¢ | `AllBookmarksPage.jsx` | SQL `ILIKE` æŸ¥è¯¢ | WHERE æ¡ä»¶ |

### 3. AI æ‘˜è¦

| åŠŸèƒ½ | å‰ç«¯ | åç«¯ | æ•°æ®åº“ |
|-----|------|------|--------|
| ç”Ÿæˆæ‘˜è¦ | `SummaryBox.jsx` | `bookmarkController.generateSummary` | `ai_summary` å­—æ®µ |

> ğŸ’¡ **æ³¨æ„**ï¼šå½“å‰ä½¿ç”¨ mock æ•°æ®ï¼Œä½ éœ€è¦æ¥å…¥çœŸå® AI API

### 4. å¤ä¹ ç³»ç»Ÿ

| åŠŸèƒ½ | å‰ç«¯ | åç«¯ | æ•°æ®åº“ |
|-----|------|------|--------|
| è®¾ç½®é—´éš” | `BookmarkEditor.jsx` | æ›´æ–° `review_interval_days` | UPDATE |
| æŸ¥çœ‹å¾…å¤ä¹  | `ReviewTodayPage.jsx` | `bookmarkController.getReviewToday` | WHERE next_review_at <= NOW() |
| æ ‡è®°å·²å¤ä¹  | `BookmarkItem.jsx` | `bookmarkController.markAsReviewed` | UPDATE last/next_review_at |

---

## ğŸ” è®¤è¯æœºåˆ¶

### Session æµç¨‹

```
1. ç”¨æˆ·ç™»å½•æˆåŠŸ
   â†“
2. åç«¯ç”Ÿæˆéšæœº sessionId
   â†“
3. å­˜å‚¨åˆ°å†…å­˜ Mapï¼šsessions.set(sessionId, { userId, createdAt })
   â†“
4. è®¾ç½® Cookieï¼šres.cookie('sessionId', sessionId)
   â†“
5. å‰ç«¯è‡ªåŠ¨åœ¨åç»­è¯·æ±‚ä¸­æºå¸¦ Cookie
   â†“
6. åç«¯ä¸­é—´ä»¶ requireAuth éªŒè¯ sessionId
   â†“
7. ä» session ä¸­è·å– userId
   â†“
8. æŒ‚è½½åˆ° req.userId
   â†“
9. æ§åˆ¶å™¨ä½¿ç”¨ req.userId æŸ¥è¯¢ç”¨æˆ·æ•°æ®
```

---

## ğŸ“Š æ•°æ®åº“å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   users     â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)     â”‚â”€â”€â”€â”
â”‚ email       â”‚   â”‚
â”‚ password    â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                  â”‚
                  â”‚ 1:N
                  â”‚
                  â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  bookmarks  â”‚
            â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
            â”‚ id (PK)     â”‚â”€â”€â”€â”
            â”‚ user_id(FK) â”‚   â”‚
            â”‚ url         â”‚   â”‚
            â”‚ title       â”‚   â”‚
            â”‚ notes       â”‚   â”‚
            â”‚ ai_summary  â”‚   â”‚
            â”‚ created_at  â”‚   â”‚
            â”‚ review_*    â”‚   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                              â”‚
                              â”‚ N:M
                              â”‚
                              â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚bookmark_tags â”‚
                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                        â”‚bookmark_id   â”‚
                        â”‚tag_id        â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚
                              â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚    tags     â”‚
                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                        â”‚ id (PK)     â”‚
                        â”‚ user_id(FK) â”‚
                        â”‚ name        â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ ç»„ä»¶å±‚æ¬¡ç»“æ„

```
App.jsx (è·¯ç”±é…ç½®)
â”‚
â”œâ”€â”€ LoginPage.jsx
â”‚
â”œâ”€â”€ SignupPage.jsx
â”‚
â””â”€â”€ AppLayout.jsx (å—ä¿æŠ¤çš„è·¯ç”±)
    â”‚
    â”œâ”€â”€ Sidebar.jsx
    â”‚   â”œâ”€â”€ Logo
    â”‚   â”œâ”€â”€ Navigation Links
    â”‚   â””â”€â”€ Logout Button
    â”‚
    â””â”€â”€ <Outlet> (å­è·¯ç”±)
        â”‚
        â”œâ”€â”€ AllBookmarksPage.jsx
        â”‚   â”œâ”€â”€ AddBookmarkForm.jsx
        â”‚   â”œâ”€â”€ Search Input
        â”‚   â””â”€â”€ BookmarkList.jsx
        â”‚       â””â”€â”€ BookmarkItem.jsx []
        â”‚           â”œâ”€â”€ BookmarkEditor.jsx
        â”‚           â””â”€â”€ SummaryBox.jsx
        â”‚
        â””â”€â”€ ReviewTodayPage.jsx
            â””â”€â”€ BookmarkList.jsx
                â””â”€â”€ BookmarkItem.jsx []
                    â”œâ”€â”€ BookmarkEditor.jsx
                    â”œâ”€â”€ SummaryBox.jsx
                    â””â”€â”€ Mark Reviewed Button
```

---

## ğŸ”§ é…ç½®æ–‡ä»¶è¯´æ˜

### å‰ç«¯é…ç½®

| æ–‡ä»¶ | ä½œç”¨ |
|-----|------|
| `vite.config.js` | Vite æ„å»ºå·¥å…·é…ç½® |
| `tailwind.config.js` | Tailwind CSS é…ç½® |
| `postcss.config.js` | PostCSS å¤„ç†å™¨é…ç½® |
| `package.json` | ä¾èµ–å’Œè„šæœ¬é…ç½® |

### åç«¯é…ç½®

| æ–‡ä»¶ | ä½œç”¨ |
|-----|------|
| `.env` | ç¯å¢ƒå˜é‡ï¼ˆæ•°æ®åº“è¿æ¥ç­‰ï¼‰ |
| `config/database.js` | PostgreSQL è¿æ¥æ± é…ç½® |
| `config/session.js` | Session å­˜å‚¨å’Œç®¡ç† |
| `package.json` | ä¾èµ–å’Œè„šæœ¬é…ç½® |

---

## ğŸ“¦ ä¾èµ–åŒ…è¯´æ˜

### å‰ç«¯ä¾èµ–

```json
{
  "react": "React æ ¸å¿ƒåº“",
  "react-dom": "React DOM æ¸²æŸ“",
  "react-router-dom": "è·¯ç”±ç®¡ç†",
  "tailwindcss": "CSS æ¡†æ¶",
  "vite": "æ„å»ºå·¥å…·"
}
```

### åç«¯ä¾èµ–

```json
{
  "express": "Web æ¡†æ¶",
  "pg": "PostgreSQL å®¢æˆ·ç«¯",
  "cors": "è·¨åŸŸèµ„æºå…±äº«",
  "dotenv": "ç¯å¢ƒå˜é‡åŠ è½½",
  "nodemon": "å¼€å‘çƒ­é‡è½½"
}
```

---

## ğŸš€ æ‰©å±•å»ºè®®

### æƒ³åŠ æ–°åŠŸèƒ½ï¼Ÿçœ‹è¿™é‡Œï¼š

#### æ·»åŠ æ–°çš„å‰ç«¯é¡µé¢
1. åœ¨ `src/pages/` åˆ›å»ºæ–°é¡µé¢ç»„ä»¶
2. åœ¨ `App.jsx` æ·»åŠ è·¯ç”±
3. åœ¨ `Sidebar.jsx` æ·»åŠ å¯¼èˆªé“¾æ¥

#### æ·»åŠ æ–°çš„ API æ¥å£
1. åœ¨ `server/controllers/` æ·»åŠ æ§åˆ¶å™¨å‡½æ•°
2. åœ¨ `server/routes/` æ·»åŠ è·¯ç”±
3. åœ¨ `client/src/api/` æ·»åŠ  API è°ƒç”¨å‡½æ•°
4. åœ¨å‰ç«¯é¡µé¢ä¸­ä½¿ç”¨

#### æ·»åŠ æ–°çš„æ•°æ®åº“è¡¨
1. åœ¨ `config/database.sql` æ·»åŠ  CREATE TABLE
2. è¿è¡Œ `npm run reset` é‡ç½®æ•°æ®åº“
3. åœ¨æ§åˆ¶å™¨ä¸­æ·»åŠ ç›¸åº”çš„ SQL æŸ¥è¯¢

---

å¸Œæœ›è¿™ä¸ªç»“æ„è¯´æ˜èƒ½å¸®åŠ©ä½ å¿«é€Ÿç†è§£é¡¹ç›®ï¼ğŸ‰

